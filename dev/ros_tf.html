<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KnowRob: TF integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-knowrob.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KnowRob
   &#160;<span id="projectnumber">dev</span>
   </div>
   <div id="projectbrief">AKnowledgeBaseSystemforCognition-enabledRobots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ros_tf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TF integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>KnowRob stores the most recent transforms in local memory. This is also the source of data for a TF publisher running in this module. There is a distinction between frames that are thought to be "managed" by KnowRob and those that are not. KnowRob will only publish managed frames on the TF topic. This is needed to avoid clashes between other TF publishing nodes such as the robot_state_publisher and the one in KnowRob.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
TF logging</h2>
<p>This module includes a logger for TF messages stored in a mongo database. The logger keeps track of previous transforms, and only writes into the database if some threshold was exceeded. TF messages are not stored in array format as this would complicate indexing the data. The logger can be toggled on or off through a setting: </p><pre class="fragment">setting(tf:use_logger, false).
</pre><h2><a class="anchor" id="autotoc_md18"></a>
TF fluent</h2>
<p>The fastest way to query persisted TF data is through the fluent predicate tf/4:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Predicate </th><th class="markdownTableHeadNone">Arguments  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tf/4 </td><td class="markdownTableBodyNone">+Frame, -ReferenceFrame, -Position, -Rotation  </td></tr>
</table>
<p>The predicate compiles into a mongo DB query, and can be potentially combined with other goals that can be computed server-side by mongo DB. As it is defined as a fluent predicate, it will allways yield the most up-to-date TF record of the child frame. It also supports querying past fluent values in case they have been persisted in the database. There exists another variant with two arguments where the second argument is a list of parent frame, position, and rotation. Note that this will only work if TF data is stored in mongo DB, e.g. by using the TF logger in this module.</p>
<p>It is also possible to write into the database by referring to tf/4 in an assertion, as in: </p><pre class="fragment">kb_call(assert(tf(myframe, map, [0,0,0], [0,0,0,1]))).
</pre><p>However, this will <em>not</em> update the internal TF memory KnowRob maintains (see tf_mem_set_pose/3). Further note that tf/4 does not allow to request a pose in some specific reference frame, for that purpose is_at/2 can be used.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
TF computable</h2>
<p>In many cases, a pose needs to be transformed into some specific reference frame in which it was not persisted in the database. A computable predicate is_at/2 is defined to support exactly this: to compute the pose of a frame wrt. some reference frame. Within this module, is_at/2 is implemented by the predicate tf_get_pose/4. For example: </p><pre class="fragment">kb_call(is_at(ns:'MyObject', [target_frame, Position, Rotation]))).
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="ros.html">ROS integration</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
